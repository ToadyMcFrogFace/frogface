<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="jquery.min.js"></script>
</head>
<body>

	<button id="guess">clicky click mother fucker</button>

	<h1 id="print"></h1>

	<div id="grid">
		
	</div>
	
</body>
</html>





<script>

	// build arena

	var grid_span = 10;

	var axes = ['x', 'y'];

	var gems = [];
	var flys = [];
	var frogs = [];

	var gem = function(x, y) {
		// constructor
		this.element = document.createElement('div');
		for(var i = 0; i < axes.length; i++) {
			this.element.dataset[axes[i]] = plot[axes[i]];
		}
		// this.element.dataset.x = x;
		// this.element.dataset.y = y;
		this.element.className = 'gem';
		this.coordinates = {x:x,y:y};
		$('#grid').append(this.element);

		gems.push(this);
	}

	var fly = function() {

		// todo:: name --> coordinate 
		this.gem = {x:spawn(), y:spawn()}

		this.move = function() {
			var newpos = [];

			for (var key in this.gem) {
				if(this.gem.hasOwnProperty(key)) {
					var dir = axisDir();
					// test if in parameters else don't move

					newpos[key] = this.gem[key];

					if(newpos[key] + dir <= grid_span && newpos[key] + dir > 0 ) {
						newpos[key] += dir;
					}
				}
			}

			if(this.gem != newpos) {
				$(plotToGem(this.gem)).removeClass('player');
				this.gem = newpos;
				$(plotToGem(this.gem)).addClass('player');
				// log(this.position);
				// this.animate_step();
			}

		}

		this.animate_step = function() {
			$(plotToGem(this.gem)).addClass('player');
		}

		function spawn() {

			return (Math.floor(Math.random() * 10) + 1);
		}
		// move() ??
		function axisDir() {

			return (Math.floor(Math.random() * 3)) - 1;
		}
	}

	var frog = function() {
		this.toGem;
		this.memory = [];
		this.memory.push({'flyGem':flys[0]['gem'],'flyMovement':{x:0,y:0}});
		this.memoryStrings = {'flyGem':{x:'|'+flys[0]['gem']['x'],y:'|'+flys[0]['gem']['y']},'flyMovement':{x:'|0',y:'|0'}};

		this.buildMemory = function() {
					
			$('.gem').removeClass('hit');
			$(plotToGem(this.toGem)).addClass('hit');


			// if(this.toGem[x] == flys[0]['gem']['x'] && this.toGem[y] == flys[0]['gem']['y']) {
			// 	console.log('hit');
			// }

			var memoryObj = {};
			var flyMovementObj = flyMovement(flys[0]['gem'], this.memory[this.memory.length - 1]['flyGem']); 
			var facts = {}
			// var pushit = {x:0,y:0]

			memoryObj['flyGem'] = flys[0]['gem'];
			// console.log(flys[0]['gem']);
			memoryObj['flyMovement'] = flyMovementObj;

			this.memoryStrings.flyGem.x += flys[0]['gem']['x'] + '|';
			this.memoryStrings.flyGem.y += flys[0]['gem']['y'] + '|';
			this.memoryStrings.flyMovement.x += flyMovementObj['x'] + '|';
			this.memoryStrings.flyMovement.y += flyMovementObj['y'] + '|';

			this.memory.push(memoryObj);
			for (var i = 0; i<axes.length; i++) {
				facts[axes[i]] = stringSearch(this.memoryStrings.flyMovement[axes[i]]);
			}

			this.toGem = guessToGem(facts);

			function guessToGem(facts) {
				// console.log(facts);
				var motion = [];
				var toGem = [];

				for (var i = 0; i<axes.length; i++) {
					var tally = [];
					var se = 0;
					var motionGuess = [];


					for(var s = 0; s < facts[axes[i]].length; s++) {

						for(var key in facts[axes[i]][s]['motionCount']) {
							if(facts[axes[i]][s]['motionCount'].hasOwnProperty(key)) {
								tally[key] = tally[key] || 0;
								tally[key] += (facts[axes[i]][s]['motionCount'][key] *facts[axes[i]][s]['substringLength']);
							}
						}

					}

					for(var key in tally) {
						if(tally.hasOwnProperty(key)) {
							if(tally[key] > se) {
								se = tally[key];
								motionGuess = key;
							}
						}
					}

					motion[axes[i]] = motionGuess;
				}


				for (var i = 0; i<axes.length; i++) {
					toGem[axes[i]] = parseInt(flys[0]['gem'][axes[i]]) + parseInt(motion[axes[i]]);
				}

				// console.log(flys[0]['gem']);
				// console.log(toGem);
				return toGem;
			}



		}

		function flyMovement(gem, fromGem) {
			// console.log(gem);
			// console.log(fromGem);
			movement = [];
			for(var i = 0; i < axes.length; i++) {
				movement[axes[i]] = gem[axes[i]] - fromGem[axes[i]];
			}
			return movement;
		}
	}

	// frog.prototype.memory = [{'flyGem':flys[0],'flyMovement':{x:0,y:0}}];

	// memory analysis 
	function stringSearch(str) {
		var pattern;
		var facts = [];
		// var oc
		for (var i = str.length; i >= 0; i--) {
			if(str.substring((i-1), i) == '|') {
				testPattern = str.substring((i-1), str.length);
				if(testPattern!='|') {
					oc = occurrences(str, testPattern, true);
					if(oc.toGem <= 1) {
						break;
					}
					facts.push(oc);
				}
			}
		}

		return facts;

	}

	/** Function that count occurrences of a substring in a string;
	 * @param {String} string               The string
	 * @param {String} subString            The sub string to search for
	 * @param {Boolean} [allowOverlapping]  Optional. (Default:false)
	 * @author Vitim.us http://stackoverflow.com/questions/4009756/how-to-count-string-occurrence-in-string/7924240#7924240
	 */
	function occurrences(string, subString, allowOverlapping) {

	    string += "";
	    subString += "";
	    if (subString.length <= 0) return (string.length + 1);

	    var n = 0,
	        pos = 0,
	        step = allowOverlapping ? 1 : subString.length,
	        motions = [];
	        facts = {substring:subString, substringLength: countPipe(subString), motionCount:{}, toGem:[]};

	    while (true) {
	        pos = string.indexOf(subString, pos);
	        if (pos >= 0 && (pos + subString.length != string.length)) {
	        	var motion = popPipe(string.substring(pos + subString.length, string.length), 0);

	        	facts.motionCount[motion] = facts.motionCount[motion]+1||1;

	        	facts.toGem.push(motion);
	            ++n
	            pos += step;
	        } else break;
	    }
	    return facts;
	}

	function popPipe(str, index) {
		var array = str.split('|');
		return parseInt(array[index]);
	}

	function countPipe(str) {
		var array = str.split('|');
		return array.length - 2;

	}

	var flys = [new fly()];
	var druid = new frog();

	$('#guess').on('click', function() {
		setInterval(function(){ 
			// log(flys);
			for(var i = 0; i < flys.length; i++) {
				flys[i].move();
			}
			druid.buildMemory();
		}, 100);
	});

	for(var i = 0; i < axes.length; i++) {
		for(var )
	}

	for(var y = grid_span; y > 0; y--) {
		for(var x = grid_span; x > 0; x--) {
			gems.push(new gem(x,y));
		}
	}

	function log(i) {
		console.log(i);
	}

	function plotToGem(coordinates) {
		var plot = '';
		for (var key in coordinates) {
			if(coordinates.hasOwnProperty(key)) { 
				plot += '[data-'+key+'="'+coordinates[key]+'"]';
			}
		}
		return plot;
	}

</script>

<style>
	.gem {
		width: 20px;
		height: 20px;
		background-color: red;
		margin: 2px;
		float: right;
	}

	.gem:nth-child(10n + 11) {
		clear: both;
	}

	.player {
		background-color: black !important; 
	}

	.hit {
		background-color: purple !important; 
	}
</style>


